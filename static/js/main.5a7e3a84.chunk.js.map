{"version":3,"sources":["level.ts","utils.ts","point.ts","field.ts","game.ts","Board.tsx","oubliette_tileset_transparent.png","sampleLevel.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Tile","range","n","Array","fill","map","_","i","Direction","parseLevel","data","height","width","console","assert","length","field","y","x","parseInt","movePoint","p","d","getTile","value","setTile","mutableField","tile","isInRange","canGoThrough","BRICK","BLOCK","includes","isFalling","pointBelow","DOWN","LADDER","ROPE","EXIT","fieldToTiles","flatMap","point","cloneModel","gameState","JSON","parse","stringify","reflect","mutModel","mutField","chara","exit","JEWEL","BLANK","beated","filter","createModel","level","xs","forEach","CHARA","queue","move","oldModel","dir","UP","newChara","newModel","dig","target","push","popped","shift","TilePos","drawCell","context","tileset","tilePosX","tilePosY","drawImage","TILE_W","TILE_H","Board","props","canvasRef","useRef","tilesetImageRef","image","Image","src","loadImage","useEffect","canvas","current","focus","getContext","fillStyle","fillRect","gameModel","clearRect","ref","tabIndex","onKeyDown","sampleLevels","label","defaultLevelString","App","useState","selectValue","setSelectValue","levelString","setLevelString","setGameModel","loadLevel","model","Box","className","style","textAlign","children","event","key","LEFT","RIGHT","preventDefault","CELL_W","CELL_H","TextField","rows","onChange","multiline","variant","Select","newLevelString","MenuItem","Button","onClick","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.5a7e3a84.chunk.js","sourcesContent":["import { range } from \"./utils\";\n\nexport enum Tile {\n  BLANK = 0,\n  BRICK = 1,\n  BLOCK = 2,\n  LADDER = 3,\n  ROPE = 4,\n  EXIT = 5,\n  JEWEL = 6,\n  CHARA = 7,\n}\n\nexport interface Level {\n  field: Tile[][];\n  width: number;\n  height: number;\n}\n\nexport const LEVEL_NROW = 12;\nexport const LEVEL_NCOL = 12;\n\nexport function parseLevel(\n  data: string,\n  height: number = LEVEL_NROW,\n  width: number = LEVEL_NCOL\n): Level {\n  console.assert(data.length === width * height);\n  const field = range(height).map((y) =>\n    range(width).map((x) => parseInt(data[y * width + x]))\n  );\n  return { field, width, height };\n}\n","export function range(n: number): number[] {\n  return Array(n)\n    .fill(0)\n    .map((_, i) => i);\n}\n\nexport function clone2dArray<T>(xss: T[][]): T[][] {\n  return xss.map((xs) => [...xs]);\n}\n","export interface Point {\n  x: number;\n  y: number;\n}\n\nexport enum Direction {\n  RIGHT = 0,\n  DOWN = 1,\n  LEFT = 2,\n  UP = 3,\n}\n\nexport function movePoint(p: Point, d: Direction): Point {\n  const dx = [1, 0, -1, 0];\n  const dy = [0, 1, 0, -1];\n  return { x: p.x + dx[d], y: p.y + dy[d] };\n}\n","import { Tile } from \"./level\";\nimport { Point, Direction, movePoint } from \"./point\";\nimport { range } from \"./utils\";\n\nexport interface Field {\n  value: Tile[][];\n  width: number;\n  height: number;\n}\n\nexport function getTile(field: Field, p: Point): Tile {\n  return field.value[p.y][p.x];\n}\n\nexport function setTile(mutableField: Field, p: Point, tile: Tile): void {\n  mutableField.value[p.y][p.x] = tile;\n}\n\nexport function isInRange(field: Field, p: Point): boolean {\n  return 0 <= p.x && p.x < field.width && 0 <= p.y && p.y < field.height;\n}\n\nexport function canGoThrough(field: Field, p: Point): boolean {\n  return (\n    isInRange(field, p) && ![Tile.BRICK, Tile.BLOCK].includes(getTile(field, p))\n  );\n}\n\nexport function isBreakable(field: Field, p: Point): boolean {\n  return (\n    isInRange(field, p) &&\n    getTile(field, p) === Tile.BRICK &&\n    canGoThrough(field, movePoint(p, Direction.UP))\n  );\n}\n\nexport function isFalling(field: Field, p: Point) {\n  const pointBelow = movePoint(p, Direction.DOWN);\n  return !(\n    [Tile.LADDER, Tile.ROPE, Tile.EXIT].includes(getTile(field, p)) ||\n    !isInRange(field, pointBelow) ||\n    [Tile.BRICK, Tile.BLOCK, Tile.LADDER, Tile.EXIT].includes(\n      getTile(field, pointBelow)\n    )\n  );\n}\n\nexport function fieldToTiles(field: Field) {\n  return range(field.height).flatMap((y) =>\n    range(field.width).map((x) => {\n      const point = { x, y };\n      const tile = getTile(field, point);\n      return { point, tile };\n    })\n  );\n}\n\nexport function countJewel(field: Field) {\n  return fieldToTiles(field).filter(({ tile }) => tile === Tile.JEWEL).length;\n}\n","import {\n  canGoThrough,\n  countJewel,\n  Field,\n  getTile,\n  isBreakable,\n  isFalling,\n  setTile,\n} from \"./field\";\nimport { Level, Tile } from \"./level\";\nimport { Direction, movePoint, Point } from \"./point\";\nimport { clone2dArray, range } from \"./utils\";\n\nconst MAXQ = 5;\n\nexport interface GameModel {\n  level: Level;\n  field: Field;\n  chara: Point;\n  exit: Point;\n  queue: Point[];\n  beated: boolean;\n}\n\nfunction cloneModel(gameState: GameModel): GameModel {\n  return JSON.parse(JSON.stringify(gameState));\n}\n\nfunction reflect(mutModel: GameModel): void {\n  const { field: mutField, chara, exit } = mutModel;\n  if (getTile(mutField, chara) === Tile.JEWEL) {\n    setTile(mutField, chara, Tile.BLANK);\n  }\n  if (getTile(mutField, chara) === Tile.EXIT) {\n    mutModel.beated = true;\n  }\n  if (countJewel(mutField) === 0) {\n    setTile(mutField, exit, Tile.EXIT);\n  }\n}\n\nexport function createModel(level: Level): GameModel {\n  const { width, height } = level;\n\n  let value: Tile[][] = clone2dArray(level.field);\n  let chara: Point = { x: 0, y: 0 };\n  let exit: Point = { x: 0, y: 0 };\n\n  range(height).forEach((y) => {\n    range(width).forEach((x) => {\n      switch (value[y][x]) {\n        case Tile.CHARA:\n          value[y][x] = Tile.BLANK;\n          chara = { x, y };\n          break;\n        case Tile.EXIT:\n          value[y][x] = Tile.BRICK;\n          exit = { x, y };\n          break;\n      }\n    });\n  });\n\n  const field = { value, width, height };\n  return { level, field, chara, exit, queue: [], beated: false };\n}\n\nexport function reset(oldModel: GameModel): GameModel {\n  return createModel(oldModel.level);\n}\n\nexport function move(oldModel: GameModel, dir: Direction): GameModel {\n  if (\n    oldModel.beated ||\n    (dir === Direction.UP &&\n      getTile(oldModel.field, oldModel.chara) !== Tile.LADDER)\n  ) {\n    return oldModel;\n  }\n  const newChara = movePoint(oldModel.chara, dir);\n  if (!canGoThrough(oldModel.field, newChara)) {\n    return oldModel;\n  }\n\n  let newModel = cloneModel(oldModel);\n  newModel.chara = newChara;\n  reflect(newModel);\n  while (isFalling(newModel.field, newModel.chara)) {\n    newModel.chara = movePoint(newModel.chara, Direction.DOWN);\n    reflect(newModel);\n  }\n\n  return newModel;\n}\n\nexport function dig(\n  oldModel: GameModel,\n  dir: Direction.LEFT | Direction.RIGHT\n): GameModel {\n  if (oldModel.beated) {\n    return oldModel;\n  }\n  const target = movePoint(movePoint(oldModel.chara, Direction.DOWN), dir);\n  if (!isBreakable(oldModel.field, target)) {\n    return oldModel;\n  }\n\n  let newModel = cloneModel(oldModel);\n  setTile(newModel.field, target, Tile.BLANK);\n  newModel.queue.push(target);\n  if (newModel.queue.length > MAXQ) {\n    const popped = newModel.queue.shift()!;\n    if (getTile(newModel.field, popped) === Tile.BLANK) {\n      setTile(newModel.field, popped, Tile.BRICK);\n    }\n  }\n\n  return newModel;\n}\n","import React, { useRef, useEffect } from \"react\";\nimport { Tile } from \"./level\";\nimport { Point } from \"./point\";\nimport { fieldToTiles } from \"./field\";\nimport { GameModel } from \"./game\";\nimport tileset from \"./oubliette_tileset_transparent.png\";\n\nconst TILE_W = 16;\nconst TILE_H = 16;\n\nexport const CELL_W = TILE_W * 3;\nexport const CELL_H = TILE_H * 3;\n\nconst TilePos = {\n  [Tile.BLANK]: { x: 6, y: 5 },\n  [Tile.BRICK]: { x: 4, y: 0 },\n  [Tile.BLOCK]: { x: 3, y: 0 },\n  [Tile.LADDER]: { x: 5, y: 4 },\n  [Tile.ROPE]: { x: 6, y: 2 },\n  [Tile.EXIT]: { x: 3, y: 3 },\n  [Tile.JEWEL]: { x: 4, y: 3 },\n  [Tile.CHARA]: { x: 1, y: 7 },\n};\n\ninterface BoardProps {\n  gameModel: GameModel;\n  width: number;\n  height: number;\n  tabIndex: number;\n  onKeyDown: (event: React.KeyboardEvent<HTMLCanvasElement>) => void;\n}\n\nfunction drawCell(\n  context: CanvasRenderingContext2D,\n  tileset: HTMLImageElement,\n  { x, y }: Point,\n  tile: Tile\n) {\n  const { x: tilePosX, y: tilePosY } = TilePos[tile];\n  context.drawImage(\n    tileset,\n    tilePosX * TILE_W + 0.25,\n    tilePosY * TILE_H + 0.25,\n    TILE_W - 0.25,\n    TILE_H - 0.25,\n    CELL_W * x,\n    CELL_H * y,\n    CELL_W,\n    CELL_H\n  );\n}\n\nfunction loadImage() {\n  const image = new Image();\n  image.src = tileset;\n  return image;\n}\n\nexport default function Board(props: BoardProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const tilesetImageRef = useRef(loadImage());\n\n  useEffect(() => {\n    const canvas = canvasRef.current!;\n    if (!canvas) return;\n\n    canvas.focus();\n    const context = canvas.getContext(\"2d\")!;\n\n    context.fillStyle = \"#0f0f3e\";\n    context.fillRect(0, 0, props.width, props.height);\n\n    const tileset = tilesetImageRef.current;\n    const { field, chara, beated } = props.gameModel;\n    fieldToTiles(field)\n      .filter(({ tile }) => tile !== Tile.BLANK)\n      .forEach(({ point, tile }) => {\n        drawCell(context, tileset, point, tile);\n      });\n    if (!beated) drawCell(context, tileset, chara, Tile.CHARA);\n\n    return () => context.clearRect(0, 0, props.width, props.height);\n  });\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width={props.width}\n      height={props.height}\n      tabIndex={props.tabIndex}\n      onKeyDown={props.onKeyDown}\n    />\n  );\n}\n","export default \"data:image/png;base64,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\"","export const sampleLevels = [\n  {\n    label: \"classic-beginner1\",\n    data:\n      \"044444400000006000030000000000030700011110031111010610030000011210034000000000000300004000000300000600000300000100000310001110000310051111000316\",\n  },\n  {\n    label: \"classic-beginner2\",\n    data:\n      \"000000000000000000000007111112111111111116111111111111111111000000600000000000000000111113122222111113111111006003144444444443100006000000000005\",\n  },\n  {\n    label: \"classic-beginner3\",\n    data:\n      \"064444000070030003003030034403043030000003003000000603403000000006003000000003003400004403406000000003003000000003003400000043043000500000000000\",\n  },\n  {\n    label: \"classic-beginner4\",\n    data:\n      \"000000000000444400000000300000070000300212121212300060000060340000000000003111111111003111111111003111161111003000100001613000000001503003100001\",\n  },\n  {\n    label: \"classic-intermediate1\",\n    data:\n      \"000000000000000000700000000061111111311111111111321221211116304440611113110001111113010001110003001011112222000100161111000100044445000100000001\",\n  },\n  {\n    label: \"classic-intermediate2\",\n    data:\n      \"000007000000101111111035131060111031131111122031131211000031131163132031131111131031131131136031131111161031136113111031111161301031000000110030\",\n  },\n  {\n    label: \"classic-intermediate3\",\n    data:\n      \"000007000000000022200000000000000000000000000000004444404030613000016230013000002030013000000030013000000030613002613030122222222222000000000005\",\n  },\n  {\n    label: \"classic-advanced1\",\n    data:\n      \"000000000700000002311111311131131111311131111111311131111111311131000611311601132212311000032200351220100202300001613262311111203202300000003000\",\n  },\n  {\n    label: \"classic-advanced2\",\n    data:\n      \"000000000000000444420000073232620000212230000000060032121300220500000230001300000030444060606030600000000030000022222030000000000316222222222222\",\n  },\n  {\n    label: \"classic-advanced3\",\n    data:\n      \"000000000000031111153000031110710300031111110300030060600300030000000300030606060300030000000300030000000300030000000300031220222213061000000013\",\n  },\n  {\n    label: \"classic-german1\",\n    data:\n      \"040440007000101001111231101111111231161161100031101111060231101111111231101111111231101111111231101116111231000000000030101111111131111111100035\",\n  },\n  {\n    label: \"classic-german2\",\n    data:\n      \"000000000000444374430000600321030000444316100310000011000316444444311110600000311110012222211111100000000005110000000311111000003111222222222222\",\n  },\n  {\n    label: \"classic-german3\",\n    data:\n      \"000000004440000000003000000000003000000000003000304040403000310101010060301616100000344404047000300010101000300000000000300000400000300000016105\",\n  },\n  {\n    label: \"classic-german4\",\n    data:\n      \"000000000000000000000000000000000000000000007000322222202222300000000005301111111111301111111111301212121212300000000000300262626262310000000000\",\n  },\n  {\n    label: \"sample-pillar\",\n    data:\n      \"000000000000\" +\n      \"000007000000\" +\n      \"000003500000\" +\n      \"000003100000\" +\n      \"000003100000\" +\n      \"000003100000\" +\n      \"000003130000\" +\n      \"000000130000\" +\n      \"000003130000\" +\n      \"000003100000\" +\n      \"000003130000\" +\n      \"000006130000\",\n  },\n];\n","import React, { useState } from \"react\";\nimport { createModel, dig, GameModel, move, reset } from \"./game\";\nimport \"./App.css\";\nimport Board, { CELL_H, CELL_W } from \"./Board\";\nimport { LEVEL_NROW, LEVEL_NCOL, parseLevel } from \"./level\";\nimport { Direction } from \"./point\";\nimport { sampleLevels } from \"./sampleLevel\";\nimport { Box, Button, MenuItem, Select, TextField } from \"@material-ui/core\";\nimport ReactMarkdown from \"react-markdown\";\n\nconst defaultLevelString = sampleLevels[0].data;\n\nconst description = `\n# Pink Virus Puzzle\nかつてパズルゲームサイト[ぼらＱ](https://web.archive.org/web/20060116224359/http://boraq.hp.infoseek.co.jp/main.htm)\\\nに掲載されていたパズルゲーム Pink Virus のクローンです。\n\n## ルール\n鍵を全部集めて出口を目指しましょう。\n- 主人公は上下左右に移動することができます。\n  - 主人公は重力の影響を受けます：移動後、以下のいずれかの条件を満たすまで落下します。\n    1. 主人公のいるマスにハシゴかロープが存在する。\n    2. 主人公の下のマスに足場（レンガ・ブロック・ハシゴ・床）が存在する。\n  - レンガとブロックのあるマスは通過することができません。\n  - 上方向への移動はハシゴのあるマスでのみ可能です。\n- 主人公は自分の左下・右下にあるレンガを破壊することができます。\n  - 対象のレンガの上に他のレンガやブロックがある場合は破壊することができません。\n  - 同時に破壊することができるレンガは5個までです。6個めのレンガを破壊すると最初に破壊したレンガが復活します。\n  - 主人公が復活したレンガに埋まってしまった場合はゲームオーバーです。\n\n## 操作方法\n- ←/↑/→/↓: 移動\n- Z/X: 左下・右下のレンガを壊す\n- R: リスタート\n\n## 使用素材\n- \"[Oubliette Tileset](https://safwyl.itch.io/oubliette-tileset)\" by [safwyl](https://safwyl.itch.io/) (licensed under [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/))\n\n`;\n\nfunction App() {\n  const [selectValue, setSelectValue] = useState(defaultLevelString);\n  const [levelString, setLevelString] = useState(defaultLevelString);\n  const [gameModel, setGameModel] = useState<GameModel>(\n    createModel(parseLevel(defaultLevelString))\n  );\n\n  function loadLevel(levelString: string) {\n    const level = parseLevel(levelString);\n    const model = createModel(level);\n    setGameModel(model);\n  }\n\n  function onLevelStringChange(event: React.ChangeEvent<{ value: string }>) {\n    setLevelString(event.target.value);\n  }\n\n  function onSelectChange(event: React.ChangeEvent<{ value: unknown }>) {\n    const newLevelString = event.target.value as string;\n    setLevelString(newLevelString);\n    setSelectValue(newLevelString);\n    loadLevel(newLevelString);\n  }\n\n  function onClick() {\n    loadLevel(levelString);\n  }\n\n  function onKeyDown<T>(event: React.KeyboardEvent<T>) {\n    switch (event.key) {\n      case \"ArrowDown\":\n        setGameModel(move(gameModel, Direction.DOWN));\n        break;\n      case \"ArrowLeft\":\n        setGameModel(move(gameModel, Direction.LEFT));\n        break;\n      case \"ArrowRight\":\n        setGameModel(move(gameModel, Direction.RIGHT));\n        break;\n      case \"ArrowUp\":\n        setGameModel(move(gameModel, Direction.UP));\n        break;\n      case \"z\":\n        setGameModel(dig(gameModel, Direction.LEFT));\n        break;\n      case \"x\":\n        setGameModel(dig(gameModel, Direction.RIGHT));\n        break;\n      case \"r\":\n        setGameModel(reset(gameModel));\n        break;\n    }\n    event.preventDefault();\n  }\n\n  return (\n    <Box className=\"App\">\n      <Box style={{ textAlign: \"left\" }}>\n        <ReactMarkdown children={description} />\n      </Box>\n      <Board\n        tabIndex={0}\n        onKeyDown={onKeyDown}\n        gameModel={gameModel}\n        width={CELL_W * LEVEL_NCOL}\n        height={CELL_H * LEVEL_NROW}\n      />\n      <TextField\n        value={levelString}\n        rows={3}\n        onChange={onLevelStringChange}\n        multiline\n        variant=\"outlined\"\n        style={{ width: 480 }}\n      />\n      <Box>\n        <Select\n          variant=\"outlined\"\n          value={selectValue}\n          onChange={onSelectChange}\n          style={{ width: 320 }}\n        >\n          {sampleLevels.map(({ label, data }) => (\n            <MenuItem key={label} value={data}>\n              {label}\n            </MenuItem>\n          ))}\n        </Select>\n      </Box>\n      <Box>\n        <Button onClick={onClick} variant=\"contained\">\n          Refresh\n        </Button>\n      </Box>\n    </Box>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}